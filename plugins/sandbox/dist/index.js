import{defineComponent as xe,computed as oe,createElementBlock as P,openBlock as L,createElementVNode as B,withKeys as qe,withModifiers as Le,h as R,toDisplayString as Q,unref as M,createCommentVNode as ge,createVNode as U,ref as X,watch as Ae,resolveComponent as q,createBlock as Z,withCtx as W,Fragment as $e,renderList as We,normalizeClass as Ye,KeepAlive as Ge}from"vue";import{useStorage as Je,receive as _e,send as Y,useMenu as Qe,useContext as Te,Schema as Oe,clone as je,deepEqual as Xe,VirtualList as Ze,message as et,icons as tt}from"@koishijs/client";import{useEventListener as De}from"@vueuse/core";var nt=Object.defineProperty,g=(e,t)=>nt(e,"name",{value:t,configurable:true});function rt(){}g(rt,"noop");function I(e){return e==null}g(I,"isNullable");function he(e){return!I(e)}g(he,"isNonNullable");function at(e){return e&&typeof e=="object"&&!Array.isArray(e)}g(at,"isPlainObject");function st(e,t){return Object.fromEntries(Object.entries(e).filter(([a,o])=>t(a,o)))}g(st,"filterKeys");function ot(e,t){return Object.fromEntries(Object.entries(e).map(([a,o])=>[a,t(o,a)]))}g(ot,"mapValues");function it(e,t,a){if(!t)return{...e};const o={};for(const i of t)(a||e[i]!==void 0)&&(o[i]=e[i]);return o}g(it,"pick");function lt(e,t){if(!t)return{...e};const a={...e};for(const o of t)Reflect.deleteProperty(a,o);return a}g(lt,"omit");function ve(e,t,a){return Object.defineProperty(e,t,{writable:true,value:a,enumerable:false})}g(ve,"defineProperty");function ut(e,t){return t.every(a=>e.includes(a))}g(ut,"contain");function ft(e,t){return e.filter(a=>t.includes(a))}g(ft,"intersection");function ct(e,t){return e.filter(a=>!t.includes(a))}g(ct,"difference");function pt(e,t){return Array.from(new Set([...e,...t]))}g(pt,"union");function dt(e){return[...new Set(e)]}g(dt,"deduplicate");function mt(e,t){const a=e==null?void 0:e.indexOf(t);return a>=0?(e.splice(a,1),true):false}g(mt,"remove");function Ne(e){return Array.isArray(e)?e:I(e)?[]:[e]}g(Ne,"makeArray");function F(e,t){return arguments.length===1?a=>F(e,a):e in globalThis&&t instanceof globalThis[e]||Object.prototype.toString.call(t).slice(8,-1)===e}g(F,"is");function ne(e){return F("ArrayBuffer",e)||F("SharedArrayBuffer",e)}g(ne,"isArrayBufferLike");function Ve(e){return ne(e)||ArrayBuffer.isView(e)}g(Ve,"isArrayBufferSource");var E;(e=>{e.is=ne,e.isSource=Ve;function t(f){return ArrayBuffer.isView(f)?f.buffer.slice(f.byteOffset,f.byteOffset+f.byteLength):f}e.fromSource=t,g(t,"fromSource");function a(f){if(typeof Buffer<"u")return Buffer.from(f).toString("base64");let s="";const c=new Uint8Array(f);for(let p=0;p<c.byteLength;p++)s+=String.fromCharCode(c[p]);return btoa(s)}e.toBase64=a,g(a,"toBase64");function o(f){return typeof Buffer<"u"?t(Buffer.from(f,"base64")):Uint8Array.from(atob(f),s=>s.charCodeAt(0))}e.fromBase64=o,g(o,"fromBase64");function i(f){return typeof Buffer<"u"?Buffer.from(f).toString("hex"):Array.from(new Uint8Array(f),s=>s.toString(16).padStart(2,"0")).join("")}e.toHex=i,g(i,"toHex");function y(f){if(typeof Buffer<"u")return t(Buffer.from(f,"hex"));const s=f.length%2===0?f:f.slice(0,f.length-1),c=[];for(let p=0;p<s.length;p+=2)c.push(parseInt(`${s[p]}${s[p+1]}`,16));return Uint8Array.from(c).buffer}e.fromHex=y,g(y,"fromHex")})(E||(E={}));E.fromBase64;E.toBase64;E.fromHex;E.toHex;function ye(e,t=new Map){if(!e||typeof e!="object")return e;if(F("Date",e))return new Date(e.valueOf());if(F("RegExp",e))return new RegExp(e.source,e.flags);if(ne(e))return e.slice(0);if(ArrayBuffer.isView(e))return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);const a=t.get(e);if(a)return a;if(Array.isArray(e)){const i=[];return t.set(e,i),e.forEach((y,f)=>{i[f]=Reflect.apply(ye,null,[y,t])}),i}const o=Object.create(Object.getPrototypeOf(e));t.set(e,o);for(const i of Reflect.ownKeys(e)){const y={...Reflect.getOwnPropertyDescriptor(e,i)};"value"in y&&(y.value=Reflect.apply(ye,null,[y.value,t])),Reflect.defineProperty(o,i,y)}return o}g(ye,"clone");function be(e,t,a){if(e===t||!a&&I(e)&&I(t))return true;if(typeof e!=typeof t||typeof e!="object"||!e||!t)return false;function o(i,y){return i(e)?i(t)?y(e,t):false:i(t)?false:void 0}return g(o,"check"),o(Array.isArray,(i,y)=>i.length===y.length&&i.every((f,s)=>be(f,y[s])))??o(F("Date"),(i,y)=>i.valueOf()===y.valueOf())??o(F("RegExp"),(i,y)=>i.source===y.source&&i.flags===y.flags)??o(ne,(i,y)=>{if(i.byteLength!==y.byteLength)return false;const f=new Uint8Array(i),s=new Uint8Array(y);for(let c=0;c<f.length;c++)if(f[c]!==s[c])return false;return true})??Object.keys({...e,...t}).every(i=>be(e[i],t[i],a))}g(be,"deepEqual");function gt(e){return e.charAt(0).toUpperCase()+e.slice(1)}g(gt,"capitalize");function ht(e){return e.charAt(0).toLowerCase()+e.slice(1)}g(ht,"uncapitalize");function Ie(e){return e.replace(/[_-][a-z]/g,t=>t.slice(1).toUpperCase())}g(Ie,"camelCase");function we(e,t,a){const o=[];let i=0;for(let y=0;y<e.length;y++){const f=e.charCodeAt(y);if(f>=65&&f<=90){if(i===1){const s=e.charCodeAt(y+1);s>=97&&s<=122&&o.push(a),o.push(f+32)}else i!==0&&o.push(a),o.push(f+32);i=1}else f>=97&&f<=122?(o.push(f),i=2):t.includes(f)?(i!==0&&o.push(a),i=0):o.push(f)}return String.fromCharCode(...o)}g(we,"tokenize");function Fe(e){return we(e,[45,95],45)}g(Fe,"paramCase");function vt(e){return we(e,[45,95],95)}g(vt,"snakeCase");var yt=Ie,bt=Fe;function xt(e){return typeof e!="string"?`[${e.toString()}]`:/^[a-z_$][\w$]*$/i.test(e)?`.${e}`:`[${JSON.stringify(e)}]`}g(xt,"formatProperty");function Re(e){return e.replace(/\/$/,"")}g(Re,"trimSlash");function _t(e){return e.startsWith("/")||(e="/"+e),Re(e)}g(_t,"sanitize");var Me;(e=>{e.millisecond=1,e.second=1e3,e.minute=e.second*60,e.hour=e.minute*60,e.day=e.hour*24,e.week=e.day*7;let t=new Date().getTimezoneOffset();function a(d){t=d}e.setTimezoneOffset=a,g(a,"setTimezoneOffset");function o(){return t}e.getTimezoneOffset=o,g(o,"getTimezoneOffset");function i(d=new Date,m){return typeof d=="number"&&(d=new Date(d)),m===void 0&&(m=t),Math.floor((d.valueOf()/e.minute-m)/1440)}e.getDateNumber=i,g(i,"getDateNumber");function y(d,m){const h=new Date(d*e.day);return m===void 0&&(m=t),new Date(+h+m*e.minute)}e.fromDateNumber=y,g(y,"fromDateNumber");const f=/\d+(?:\.\d+)?/.source,s=new RegExp(`^${["w(?:eek(?:s)?)?","d(?:ay(?:s)?)?","h(?:our(?:s)?)?","m(?:in(?:ute)?(?:s)?)?","s(?:ec(?:ond)?(?:s)?)?"].map(d=>`(${f}${d})?`).join("")}$`);function c(d){const m=s.exec(d);return m?(parseFloat(m[1])*e.week||0)+(parseFloat(m[2])*e.day||0)+(parseFloat(m[3])*e.hour||0)+(parseFloat(m[4])*e.minute||0)+(parseFloat(m[5])*e.second||0):0}e.parseTime=c,g(c,"parseTime");function p(d){const m=c(d);return m?d=Date.now()+m:/^\d{1,2}(:\d{1,2}){1,2}$/.test(d)?d=`${new Date().toLocaleDateString()}-${d}`:/^\d{1,2}-\d{1,2}-\d{1,2}(:\d{1,2}){1,2}$/.test(d)&&(d=`${new Date().getFullYear()}-${d}`),d?new Date(d):new Date}e.parseDate=p,g(p,"parseDate");function $(d){const m=Math.abs(d);return m>=e.day-e.hour/2?Math.round(d/e.day)+"d":m>=e.hour-e.minute/2?Math.round(d/e.hour)+"h":m>=e.minute-e.second/2?Math.round(d/e.minute)+"m":m>=e.second?Math.round(d/e.second)+"s":d+"ms"}e.format=$,g($,"format");function _(d,m=2){return d.toString().padStart(m,"0")}e.toDigits=_,g(_,"toDigits");function j(d,m=new Date){return d.replace("yyyy",m.getFullYear().toString()).replace("yy",m.getFullYear().toString().slice(2)).replace("MM",_(m.getMonth()+1)).replace("dd",_(m.getDate())).replace("hh",_(m.getHours())).replace("mm",_(m.getMinutes())).replace("ss",_(m.getSeconds())).replace("SSS",_(m.getMilliseconds(),3))}e.template=j,g(j,"template")})(Me||(Me={}));var wt=Object.defineProperty,kt=Object.getOwnPropertyNames,w=(e,t)=>wt(e,"name",{value:t,configurable:true}),Ct=(e,t)=>function(){return t||(0,e[kt(e)[0]])((t={exports:{}}).exports,t),t.exports},St=Ct({"src/index.ts"(e,t){var f;var a=Symbol.for("satori.element"),o=(f=class{get data(){return this.attrs}getTagName(){var c;return this.type==="component"?((c=this.attrs.is)==null?void 0:c.name)??"component":this.type}toAttrString(){return Object.entries(this.attrs).map(([c,p])=>I(p)?"":(c=bt(c),p===true?` ${c}`:p===false?` no-${c}`:` ${c}="${i.escape(""+p,true)}"`)).join("")}toString(c=false){if(this.type==="text"&&"content"in this.attrs)return c?this.attrs.content:i.escape(this.attrs.content);const p=this.children.map(j=>j.toString(c)).join("");if(c)return p;const $=this.toAttrString(),_=this.getTagName();return this.children.length?`<${_}${$}>${p}</${_}>`:`<${_}${$}/>`}},w(f,"ElementConstructor"),f);ve(o,"name","Element"),ve(o.prototype,a,true);function i(s,...c){const p=Object.create(o.prototype),$={},_=[];if(c[0]&&typeof c[0]=="object"&&!i.isElement(c[0])&&!Array.isArray(c[0])){const j=c.shift();for(const[d,m]of Object.entries(j))I(m)||(d==="children"?c.push(...Ne(m)):$[yt(d)]=m)}for(const j of c)_.push(...i.toElementArray(j));return typeof s=="function"&&($.is=s,s="component"),Object.assign(p,{type:s,attrs:$,children:_})}w(i,"Element");var y=new Function("expr","context",`
  try {
    with (context) {
      return eval(expr)
    }
  } catch {}
`);(s=>{s.jsx=s,s.jsxs=s,s.jsxDEV=s,s.Fragment="template";function c(n){return n&&typeof n=="object"&&n[a]}s.isElement=c,w(c,"isElement");function p(n){if(typeof n=="string"||typeof n=="number"||typeof n=="boolean"){if(n=""+n,n)return s("text",{content:n})}else{if(c(n))return n;if(!I(n))throw new TypeError(`Invalid content: ${n}`)}}s.toElement=p,w(p,"toElement");function $(n){return Array.isArray(n)?n.map(p).filter(he):[p(n)].filter(he)}s.toElementArray=$,w($,"toElementArray");function _(n,r){return typeof n=="string"?O(n,r):$(n)}s.normalize=_,w(_,"normalize");function j(n,r=false){const l=(n??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return r?l.replace(/"/g,"&quot;"):l}s.escape=j,w(j,"escape");function d(n){return n.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#(\d+);/g,(r,l)=>l==="38"?r:String.fromCharCode(+l)).replace(/&#x([0-9a-f]+);/gi,(r,l)=>l==="26"?r:String.fromCharCode(parseInt(l,16))).replace(/&(amp|#38|#x26);/g,"&")}s.unescape=d,w(d,"unescape");function m(n,r={}){var u;const l=O(n);return r.caret?r.type&&((u=l[0])==null?void 0:u.type)!==r.type?void 0:l[0]:z(l,r.type||"*")[0]}s.from=m,w(m,"from");const h=/ *([ >+~]) */g;function k(n){return n.split(",").map(r=>{const l=[];r=r.trim();let u,b=" ";for(;u=h.exec(r);)l.push({type:r.slice(0,u.index),combinator:b}),b=u[1],r=r.slice(u.index+u[0].length);return l.push({type:r,combinator:b}),l})}s.parseSelector=k,w(k,"parseSelector");function z(n,r){if(!n||!r)return[];if(typeof n=="string"&&(n=O(n)),typeof r=="string"&&(r=k(r)),!r.length)return[];let l=[];const u=[];for(const[b,x]of n.entries()){const S=[],D=[...r,...l];l=[];let C=false;for(const A of D){const{type:N,combinator:ae}=A[0];(N===x.type||N==="*")&&(A.length===1?C=true:[" ",">"].includes(A[1].combinator)?S.push(A.slice(1)):A[1].combinator==="+"?l.push(A.slice(1)):r.push(A.slice(1))),ae===" "&&S.push(A)}C&&u.push(n[b]),u.push(...z(x.children,S))}return u}s.select=z,w(z,"select");function V(n,r){if(n=n.trim(),!/^[\w.]+$/.test(n))return y(n,r)??"";let l=r;for(const u of n.split("."))if(l=l[u],I(l))return"";return l??""}s.interpolate=V,w(V,"interpolate");const le=/(?<comment><!--[\s\S]*?-->)|(?<tag><(\/?)([^!\s>/]*)([^>]*?)\s*(\/?)>)/,ue=/(?<comment><!--[\s\S]*?-->)|(?<tag><(\/?)([^!\s>/]*)([^>]*?)\s*(\/?)>)|(?<curly>\{(?<derivative>[@:/#][^\s}]*)?[\s\S]*?\})/,fe=/([^\s=]+)(?:="(?<value1>[^"]*)"|='(?<value2>[^']*)')?/g,ce=/([^\s=]+)(?:="(?<value1>[^"]*)"|='(?<value2>[^']*)'|=\{(?<curly>[^}]+)\})?/g;let re;(n=>{n[n.OPEN=0]="OPEN",n[n.CLOSE=1]="CLOSE",n[n.EMPTY=2]="EMPTY",n[n.CONTINUE=3]="CONTINUE"})(re||(re={}));function O(n,r){const l=[];function u(C){C&&l.push(C)}w(u,"pushText");const b=r?ue:le;let x,S=true;for(;x=b.exec(n);){const{curly:C,comment:A,derivative:N}=x.groups,ae=!C;D(n.slice(0,x.index),S,ae),S=ae,n=n.slice(x.index+x[0].length);const[Ue,,,Pe,Ee,He,Ke]=x;if(!A){if(C){let Ce="",Se=2;N&&(Ce=N.slice(1),Se={"@":2,"#":0,"/":1,":":3}[N[0]]),l.push({type:"curly",name:Ce,position:Se,source:C,extra:C.slice(1+(N??"").length,-1)});continue}l.push({type:"angle",source:Ue,name:Ee||s.Fragment,position:Pe?1:Ke?2:0,extra:He})}}D(n,S,true);function D(C,A,N){C=d(C),A&&(C=C.replace(/^\s*\n\s*/,"")),N&&(C=C.replace(/\s*\n\s*$/,"")),u(C)}return w(D,"parseContent"),K(H(l),r)}s.parse=O,w(O,"parse");function H(n){const r=[[{type:"angle",name:s.Fragment,position:0,source:"",extra:"",children:{default:[]}},"default"]];function l(...u){const[b,x]=r[0];b.children[x].push(...u)}w(l,"pushToken");for(const u of n){if(typeof u=="string"){l(u);continue}const{name:b,position:x}=u;x===1?r[0][0].name===b&&r.shift():x===3?(r[0][0].children[b]=[],r[0][1]=b):x===0?(l(u),u.children={default:[]},r.unshift([u,"default"])):l(u)}return r[r.length-1][0].children.default}w(H,"foldTokens");function K(n,r){const l=[];for(const u of n)if(typeof u=="string")l.push(s("text",{content:u}));else if(u.type==="angle"){const b={},x=r?ce:fe;let S;for(;S=x.exec(u.extra);){const[,D,C,A=C,N]=S;N?b[D]=V(N,r):I(A)?D.startsWith("no-")?b[D.slice(3)]=false:b[D]=true:b[D]=d(A)}l.push(s(u.name,b,u.children&&K(u.children.default,r)))}else if(!u.name)l.push(...$(V(u.extra,r)));else if(u.name==="if")y(u.extra,r)?l.push(...K(u.children.default,r)):l.push(...K(u.children.else||[],r));else if(u.name==="each"){const[b,x]=u.extra.split(/\s+as\s+/),S=V(b,r);if(!S||!S[Symbol.iterator])continue;for(const D of S)l.push(...K(u.children.default,{...r,[x]:D}))}return l}w(K,"parseTokens");function pe(n,r,l){const{type:u,attrs:b,children:x}=n;if(typeof r=="function")return r(n,l);{let S=r[typeof u=="string"?u:""]??r.default??true;return typeof S=="function"&&(S=S(b,x,l)),S}}w(pe,"visit");function de(n,r,l){const u=typeof n=="string"?O(n):n,b=[];return u.forEach(x=>{const{type:S,attrs:D,children:C}=x,A=pe(x,r,l);A===true?b.push(s(S,D,de(C,r,l))):A!==false&&b.push(...$(A))}),typeof n=="string"?b.join(""):b}s.transform=de,w(de,"transform");async function me(n,r,l){const u=typeof n=="string"?O(n):n,b=(await Promise.all(u.map(async x=>{const{type:S,attrs:D,children:C}=x,A=await pe(x,r,l);return A===true?[s(S,D,await me(C,r,l))]:A!==false?$(A):[]}))).flat(1);return typeof n=="string"?b.join(""):b}s.transformAsync=me,w(me,"transformAsync");function T(n,...r){return(...l)=>{const u=s(n);return r.forEach((b,x)=>{I(l[x])||(u.attrs[b]=l[x])}),l[r.length]&&Object.assign(u.attrs,l[r.length]),u}}w(T,"createFactory"),s.warn=w(()=>{},"warn");function G(n){return(r,...l)=>{let u="base64://";return typeof l[0]=="string"&&(u=`data:${l.shift()};base64,`),F("Buffer",r)?r=u+r.toString("base64"):F("ArrayBuffer",r)?r=u+E.toBase64(r):ArrayBuffer.isView(r)&&(r=u+E.toBase64(r.buffer)),r.startsWith("base64://")&&(0,s.warn)('protocol "base64:" is deprecated and will be removed in the future, please use "data:" instead'),s(n,{...l[0],src:r})}}w(G,"createAssetFactory"),s.text=T("text","content"),s.at=T("at","id"),s.sharp=T("sharp","id"),s.quote=T("quote","id"),s.image=G("img"),s.img=G("img"),s.video=G("video"),s.audio=G("audio"),s.file=G("file");function ke(n,r){return s("i18n",typeof n=="string"?{path:n}:n,r)}s.i18n=ke,w(ke,"i18n")})(i||(i={})),t.exports=i}});const te=St(),At={class:"textarea"},$t=["value","placeholder","onKeydown"],Ot=xe({__name:"input",props:{target:{default:()=>document},modelValue:{default:""},placeholder:{}},emits:["send","update:modelValue"],setup(e,{emit:t}){const a=t,o=e,i=oe({get:()=>o.modelValue,set:p=>a("update:modelValue",p)});function y(){i.value&&(a("send",te.escape(i.value)),i.value="")}function f(p){i.value=p.target.value}function s(p,$){if($)for(const _ of $.items){if(_.kind!=="file")continue;const j=_.getAsFile();if(!j)continue;p.preventDefault();const[d]=j.type.split("/",1);if(!["image","audio","video"].includes(d)){console.warn("Unsupported file type:",j.type);return}const m=new FileReader;m.addEventListener("load",function(){a("send",te(d==="image"?"img":d,{src:m.result}).toString())},false),m.readAsDataURL(j)}}De(o.target,"drop",p=>{s(p,p.dataTransfer)}),De(o.target,"dragover",p=>{p.preventDefault()});async function c(p){s(p,p.clipboardData)}return(p,$)=>(L(),P("div",At,[B("input",{autocomplete:"off",step:"any",value:i.value,placeholder:e.placeholder,onInput:f,onPaste:c,onKeydown:qe(Le(y,["stop"]),["enter"])},null,40,$t)]))}}),ie=(e,t)=>{const a=e.__vccOpts||e;for(const[o,i]of t)a[o]=i;return a},jt=ie(Ot,[["__scopeId","data-v-60f4d521"]]),Dt=["b","strong","i","em","u","ins","s","del","code"],ee=(e,t)=>e.map(({type:a,attrs:o,children:i})=>a==="text"?o.content:a==="at"?R("span",`@${o.name}`):a==="img"?R("img",{src:o.src,alt:o.alt}):a==="audio"?R("audio",{src:o.src,controls:true}):a==="video"?R("video",{src:o.src,controls:true}):Dt.includes(a)?R(a,ee(i)):a==="spl"?R("span",{class:"spoiler"},ee(i)):a==="p"||a==="message"?R("p",ee(i)):a==="iframe"?R("iframe",{innerHTML:o.content}):ee(i)),Mt={name:"message-content",props:{content:{type:String,required:true}},setup(e,t){return()=>R("div",{class:"message-content"},ee(te.parse(e.content)))}},Be=ie(Mt,[["__scopeId","data-v-f996f5a6"]]),Bt={private:"私聊模式",guild:"群聊模式",profile:"用户设置"},v=Je("sandbox",1.1,()=>({platform:"sandbox:"+Math.random().toString(36).slice(2),user:"",index:0,messages:{},panelType:"private"})),J=oe(()=>v.value.panelType==="guild"?"#":"@"+v.value.user);_e("sandbox/message",e=>{var t,a;e.platform===v.value.platform&&((t=v.value.messages)[a=e.channel]||(t[a]=[])).push(e)});_e("sandbox/clear",()=>{v.value.messages[J.value]=[]});const se={deleteMessage({messageId:e,channelId:t}){const a=v.value.messages[t];a&&(v.value.messages[t]=a.filter(o=>o.id!==e))},getMessage({messageId:e,channelId:t}){var a;return(a=v.value.messages[t])==null?void 0:a.find(o=>o.id===e)},getChannel({channelId:e,guildId:t}){return{channelId:"#"}},getChannelList({guildId:e}){return{data:{channelId:"#"}}},getGuild({guildId:e}){return{guildId:"#"}},getGuildList(){return{data:{guildId:"#"}}},getGuildMember({guildId:e,userId:t}){return{userId:t,username:t}},getGuildMemberList({guildId:e}){return{data:Object.keys(v.value.messages).filter(a=>a.startsWith("@")).map(a=>{const o=a.slice(1);return{userId:o,username:o}})}}};_e("sandbox/request",({method:e,nonce:t,data:a})=>{var i;const o=(i=se[e])==null?void 0:i.call(se,a);Y("sandbox/response",t,o)});const zt=["Alice","Bob","Carol","Dave","Eve","Frank","Grace","Hank","Ivy","Jack","Kathy","Lily","Mandy","Nancy","Oscar","Peggy","Quinn","Randy","Sandy","Toby","Uma","Vicky","Wendy","Xander","Yvonne","Zoe"],Lt={class:"chat-message"},Nt={class:"avatar"},Vt={class:"nickname"},It={key:0,class:"quote"},Ft={class:"abstract"},Rt=xe({__name:"message",props:{data:{}},setup(e){const t=Qe("sandbox.message");return(a,o)=>(L(),P("div",Lt,[B("div",Nt,Q(e.data.user[0]),1),B("div",Vt,Q(e.data.user),1),B("div",{class:"message-box",onContextmenu:o[0]||(o[0]=Le(i=>M(t)(i,e.data),["stop"]))},[e.data.quote?(L(),P("blockquote",It,[B("span",Ft,[U(M(Be),{content:e.data.quote.content},null,8,["content"])])])):ge("v-if",true),U(M(Be),{content:e.data.content},null,8,["content"])],32)]))}}),Ut=ie(Rt,[["__scopeId","data-v-4057f070"]]),Pt={class:"user-container"},Et={class:"avatar"},Ht={class:"nick"},Kt=["onClick"],qt={class:"card-header"},Wt=["onClick"],Yt={class:"card-footer"},Gt={key:0,class:"quote"},Jt={class:"left"},ze=10,Qt=xe({__name:"layout",setup(e){const t=Te();t.action("sandbox.message.delete",{action:({sandbox:h})=>m(h.message)}),t.action("sandbox.message.quote",{action:({sandbox:h})=>p.value=h.message});const a=Oe.object({authority:Oe.natural().description("权限等级")}),o=oe(()=>Object.keys(v.value.messages).filter(h=>h.startsWith("@")).map(h=>h.slice(1))),i=oe(()=>Object.fromEntries(o.value.map(h=>[h,{name:h}])));function y(){if(o.value.length>=ze)return et.error("可创建的用户数量已达上限。");let h;do h=zt[v.value.index++],v.value.index%=ze;while(o.value.includes(h));v.value.user=h,v.value.messages["@"+h]=[],Y("sandbox/set-user",v.value.platform,v.value.user,{})}function f(h){const k=o.value.indexOf(h);delete v.value.messages["@"+h],Y("sandbox/set-user",v.value.platform,v.value.user,null),v.value.user===h&&(v.value.user=o.value[k]||"")}const s=X(""),c=X(0),p=X();function $(h){if(h.key==="ArrowUp"){const k=v.value.messages[J.value].filter(V=>V.user===v.value.user);let z=k.length-c.value;k[z-1]&&(c.value++,s.value=te.unescape(k[z-1].content))}else if(h.key==="ArrowDown"){const k=v.value.messages[J.value].filter(V=>V.user===v.value.user);let z=k.length-c.value;k[z+1]?(c.value--,s.value=te.unescape(k[z+1].content)):c.value&&(c.value=0,s.value="")}}const _=X(),j=X();Ae(()=>v.value.user,async h=>{h&&(_.value=await Y("sandbox/get-user",v.value.platform,v.value.user),j.value=je(_.value))},{immediate:true}),Ae(j,async h=>{Xe(h,_.value)||(await Y("sandbox/set-user",v.value.platform,v.value.user,h),_.value=je(h))},{deep:true});function d(h){c.value=0,Y("sandbox/send-message",v.value.platform,v.value.user,J.value,h,p.value),p.value=null}async function m(h){await Y("sandbox/delete-message",h.platform,h.user,h.channel,h.id),se.deleteMessage({messageId:h.id,channelId:h.channel})}return(h,k)=>{const z=q("k-icon"),V=q("k-tab-group"),le=q("el-scrollbar"),ue=q("k-empty"),fe=q("k-form"),ce=q("k-content"),re=q("k-layout");return L(),Z(re,{class:"page-sandbox"},{left:W(()=>[B("div",{class:"card-header k-tab-menu-item",onClick:y},"添加用户"),B("div",Pt,[U(le,null,{default:W(()=>[U(V,{data:i.value,modelValue:M(v).user,"onUpdate:modelValue":k[0]||(k[0]=O=>M(v).user=O)},{default:W(({name:O})=>[B("div",Et,Q(O[0]),1),B("div",Ht,Q(O),1),B("div",{class:"close",onClick:H=>f(O)},[U(z,{name:"times-full"})],8,Kt)]),_:1},8,["data","modelValue"])]),_:1})])]),default:W(()=>[B("div",qt,[(L(true),P($e,null,We(M(Bt),(O,H)=>(L(),P("span",{key:H,class:Ye(["k-horizontal-tab-item",{active:M(v).panelType===H}]),onClick:K=>M(v).panelType=H},Q(O),11,Wt))),128))]),(L(),Z(Ge,null,[o.value.length?M(v).panelType==="profile"?(L(),Z(ce,{key:"profile"+M(J)},{default:W(()=>[_.value?(L(),Z(fe,{key:0,initial:_.value,modelValue:j.value,"onUpdate:modelValue":k[1]||(k[1]=O=>j.value=O),schema:M(a),"show-header":false},null,8,["initial","modelValue","schema"])):ge("v-if",true)]),_:1})):(L(),P($e,{key:2},[U(M(Ze),{data:M(v).messages[M(J)]||[],pinned:""},{default:W(O=>[U(Ut,{data:O},null,8,["data"])]),_:1},8,["data"]),B("div",Yt,[p.value?(L(),P("div",Gt,[B("span",Jt,"正在回复 @"+Q(p.value.user),1),U(z,{name:"times-full",onClick:k[2]||(k[2]=O=>p.value=null)})])):ge("v-if",true),U(M(jt),{modelValue:s.value,"onUpdate:modelValue":k[3]||(k[3]=O=>s.value=O),onSend:d,onKeydown:$,placeholder:"发送消息到沙盒"},null,8,["modelValue"])])],64)):(L(),Z(ue,{key:"empty"},{default:W(()=>[...k[4]||(k[4]=[B("div",null,"点击「添加用户」开始体验",-1)])]),_:1}))],1024))]),_:1})}}}),Tt={},Xt={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"};function Zt(e,t){return L(),P("svg",Xt,[...t[0]||(t[0]=[B("path",{fill:"currentColor",d:"M437.2 403.5L319.1 215l.0001-135C319.1 71.16 312.8 64 303.1 64S288 71.16 288 79.1L287.1 215c0 5.973 1.672 11.83 4.826 16.9L347.6 320H100.4l54.79-88.1C158.3 226.8 160 220.1 160 215L160 79.1C160 71.16 152.8 64 144 64S128 71.16 128 79.1L128 215l-117.2 188.5C-18.48 450.6 15.27 512 70.89 512h306.2C432.7 512 466.5 450.5 437.2 403.5zM410.9 460C407.6 466 397.6 480 377.1 480H70.89c-20.51 0-30.48-13.95-33.82-19.95c-7.025-12.63-6.691-27.46 .873-39.65L80.48 352h287l42.55 68.41C417.6 432.6 417.1 447.4 410.9 460zM112 32h224C344.8 32 352 24.84 352 16S344.8 0 336 0h-224C103.2 0 96 7.156 96 16S103.2 32 112 32z"},null,-1)])])}const en=ie(Tt,[["render",Zt]]);tt.register("activity:flask",en);const an=e=>{e.page({name:"沙盒",path:"/sandbox",icon:"activity:flask",order:300,authority:4,component:Qt}),e.menu("sandbox.message",[{id:".delete",label:"删除消息"},{id:".quote",label:"引用回复"}])};export{an as default};
