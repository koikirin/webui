import{defineAsyncComponent as M,ref as L,defineComponent as k,h as C,resolveComponent as _,createBlock as V,openBlock as p,createSlots as S,withCtx as a,createVNode as u,createElementVNode as l,toDisplayString as m,renderSlot as z,createTextVNode as i,provide as D,computed as A,createElementBlock as g,createCommentVNode as F,unref as f,Fragment as I}from"vue";import{store as c,icons as b}from"@koishijs/client";const N=M(()=>import("./echarts-A5NEL5Fy.mjs")),h=L("send");function H({title:n,fields:e,showTab:s,options:t}){return k({render:()=>{if(!e.every(r=>c[r]))return null;const o=t(c,h.value);if(o)return C(_("k-card"),{class:"frameless analytic-chart"},{header:()=>[C("span",{class:"left"},[n]),...s?[C("span",{class:"right"},[C("span",{class:"tab-item"+(h.value==="send"?" active":""),onClick:()=>h.value="send"},["发送"]),C("span",{class:"tab-item"+(h.value==="receive"?" active":""),onClick:()=>h.value="receive"},["接收"])])]:[]],default:()=>C(N,{option:o,autoresize:true})})}})}var y;(n=>{n.item=e=>({trigger:"item",formatter:e}),n.axis=e=>({trigger:"axis",axisPointer:{type:"cross"},formatter:e})})(y||(y={}));const j=n=>{n.slot({type:"analytic-chart",component:H({title:"指令调用频率",fields:["analytics"],options({analytics:e}){const s=Object.entries(e.commandRate).sort((t,o)=>o[1]-t[1]).map(([t,o])=>({name:t,value:o}));if(s.length)return{tooltip:y.item(({data:t})=>{const o=[t.name];return o.push(`日均调用：${+t.value.toFixed(1)}`),o.join("<br>")}),series:[{type:"pie",data:s,radius:["35%","65%"],minShowLabelAngle:3}]}}})})},O=n=>{n.slot({type:"analytic-chart",component:H({title:"各平台消息占比",fields:["analytics"],showTab:true,options({analytics:e},s){const t=Object.entries(e.messageByBot).map(([r,d])=>({name:r,children:Object.entries(d).map(([x,$])=>({name:$.name||x,value:$[s]}))}));if(t.reduce((r,{children:d})=>r+d.reduce((x,{value:$})=>x+$,0),0))return{tooltip:y.item(({data:r})=>`${r.children?"平台":"昵称"}：${r.name}<br>日均消息数量：${+r.value.toFixed(1)}`),series:[{type:"sunburst",data:t,radius:["0","65%"],nodeClick:false,emphasis:{focus:"ancestor"},levels:[{},{label:{rotate:"tangential"}},{label:{position:"outside",padding:3,silent:false}}]}]}}})})},T="日一二三四五六",U=n=>{n.slot({type:"analytic-chart",component:H({title:"历史消息数量",fields:["analytics"],showTab:true,options({analytics:e},s){if(!e.messageByDate.length)return;const t=e.messageByDate.slice(1);return{tooltip:y.axis(([{name:o,value:r}])=>{const d=new Date(o).getDay();return`${o} 星期${T[d]}<br>消息数量：${r}`}),xAxis:{type:"category",data:t.map((o,r)=>new Date(Date.now()-(r+1)*864e5).toLocaleDateString("zh-CN")).reverse()},yAxis:{type:"value"},series:{type:"line",smooth:true,data:t.map(o=>o[s]).reverse()}}}})})},B=n=>`${(n-.5).toFixed()}:00-${(n+.5).toFixed()}:00`,E=n=>{n.slot({type:"analytic-chart",component:H({title:"每小时消息数量",fields:["analytics"],showTab:true,options({analytics:e},s){if(!e.messageByHour.every(t=>!t[s]))return{tooltip:y.axis(t=>{const[{data:[o],dataIndex:r}]=t,d=e.messageByHour[r];return[`${B(o)}`,`日均消息数量：${+(d[s]||0).toFixed(1)}`].join("<br>")}),xAxis:{type:"value",min:0,max:24,minInterval:1,maxInterval:4,axisLabel:{formatter:t=>t+":00"},axisPointer:{label:{formatter:({value:t})=>B(t)}}},yAxis:{type:"value"},series:[{data:e.messageByHour.map((t,o)=>[o+.5,t[s]||0]),type:"bar",stack:"1"}]}}})})},G=n=>{n.plugin(U),n.plugin(E),n.plugin(O),n.plugin(j)},P={class:"content"},R={class:"title"},q={class:"value"},J={class:"left"},K={class:"right"},w=k({__name:"numeric",props:{title:{},icon:{}},setup(n){return(e,s)=>{const t=_("k-icon"),o=_("k-card");return p(),V(o,{class:"k-analytic-number"},S({default:a(()=>[u(t,{name:n.icon},null,8,["name"]),l("div",P,[l("p",R,m(n.title),1),l("p",q,[z(e.$slots,"default",{},()=>[s[0]||(s[0]=i("-",-1))])])])]),_:2},[e.$slots["footer-left"]?{name:"footer",fn:a(()=>[l("span",J,[z(e.$slots,"footer-left")]),l("span",K,[z(e.$slots,"footer-right",{},()=>[s[1]||(s[1]=i("-",-1))])])]),key:"0"}:void 0]),1024)}}}),Q={key:0,class:"card-grid numeric-grid"},W=k({__name:"index",setup(n){D("component:analytic-number",w);const e=A(()=>{const s=c.analytics.dauHistory.slice(1),t=c.analytics.dauHistory.length-1;return t?s.reduce((o,r)=>o+r,0)/Math.min(s.length,t):0});return(s,t)=>{const o=_("k-slot-item"),r=_("k-slot");return f(c).analytics?(p(),g("div",Q,[u(r,{name:"analytic-number"},{default:a(()=>[u(o,null,{default:a(()=>[u(w,{icon:"analytic:user",title:"用户数量"},{default:a(()=>[i(m(f(c).analytics.userCount),1)]),"footer-left":a(()=>[...t[0]||(t[0]=[i("昨日新增用户",-1)])]),"footer-right":a(()=>[i(m(f(c).analytics.userIncrement),1)]),_:1}),u(w,{icon:"analytic:guild",title:"群组数量"},{default:a(()=>[i(m(f(c).analytics.guildCount),1)]),"footer-left":a(()=>[...t[1]||(t[1]=[i("昨日新增群组",-1)])]),"footer-right":a(()=>[i(m(f(c).analytics.guildIncrement),1)]),_:1}),u(w,{icon:"analytic:heart",title:"今日 DAU"},{default:a(()=>[i(m(f(c).analytics.dauHistory[0]),1)]),"footer-left":a(()=>[...t[2]||(t[2]=[i("近期 DAU",-1)])]),"footer-right":a(()=>[i(m(+e.value.toFixed(1)),1)]),_:1})]),_:1})]),_:1})])):F("v-if",true)}}}),v=(n,e)=>{const s=n.__vccOpts||n;for(const[t,o]of e)s[t]=o;return s},X=v(W,[["__scopeId","data-v-13f04675"]]),Y={class:"card-grid chart-grid"},Z=k({__name:"home",setup(n){return(e,s)=>{const t=_("k-slot");return p(),g(I,null,[u(X),l("div",Y,[u(t,{name:"analytic-chart"})])],64)}}}),tt={},et={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 512"};function nt(n,e){return p(),g("svg",et,[...e[0]||(e[0]=[l("path",{fill:"currentColor",d:"M274.7 304H173.3c-95.73 0-173.3 77.6-173.3 173.3C0 496.5 15.52 512 34.66 512H413.3C432.5 512 448 496.5 448 477.3C448 381.6 370.4 304 274.7 304zM413.3 480H34.66C33.2 480 32 478.8 32 477.3C32 399.4 95.4 336 173.3 336H274.7C352.6 336 416 399.4 416 477.3C416 478.8 414.8 480 413.3 480zM224 256c70.7 0 128-57.31 128-128S294.7 0 224 0C153.3 0 96 57.31 96 128S153.3 256 224 256zM224 32c52.94 0 96 43.06 96 96c0 52.93-43.06 96-96 96S128 180.9 128 128C128 75.06 171.1 32 224 32zM375.1 241C392.9 250.8 412.3 256 432 256C493.8 256 544 205.8 544 144S493.8 32 432 32c-12.83 0-25.39 2.156-37.34 6.391c-8.328 2.953-12.69 12.09-9.734 20.42c2.953 8.344 12.12 12.66 20.42 9.734C413.9 65.53 422.8 64 432 64C476.1 64 512 99.89 512 144S476.1 224 432 224c-14.08 0-27.91-3.703-39.98-10.69c-7.656-4.453-17.44-1.828-21.86 5.828C365.7 226.8 368.3 236.6 375.1 241zM490.7 320H448c-8.844 0-16 7.156-16 16S439.2 352 448 352h42.67C555.4 352 608 404.6 608 469.3C608 475.2 603.2 480 597.3 480H496c-8.844 0-16 7.156-16 16s7.156 16 16 16h101.3C620.9 512 640 492.9 640 469.3C640 386.1 573 320 490.7 320z"},null,-1)])])}const ot=v(tt,[["render",nt]]),st={},rt={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"};function at(n,e){return p(),g("svg",rt,[...e[0]||(e[0]=[l("path",{fill:"currentColor",d:"M255.1 96L267.1 84.02C300.6 51.37 347 36.51 392.6 44.1C461.5 55.58 512 115.2 512 185.1V190.9C512 232.4 494.8 272.1 464.4 300.4L283.7 469.1C276.2 476.1 266.3 480 256 480C245.7 480 235.8 476.1 228.3 469.1L47.59 300.4C17.23 272.1 0 232.4 0 190.9V185.1C0 115.2 50.52 55.58 119.4 44.1C164.1 36.51 211.4 51.37 244 84.02L255.1 96zM255.1 141.3L221.4 106.6C196.1 81.31 160 69.77 124.7 75.66C71.21 84.58 31.1 130.9 31.1 185.1V190.9C31.1 223.6 45.55 254.7 69.42 277L250.1 445.7C251.7 447.2 253.8 448 255.1 448C258.2 448 260.3 447.2 261.9 445.7L442.6 277C466.4 254.7 480 223.6 480 190.9V185.1C480 130.9 440.8 84.58 387.3 75.66C351.1 69.77 315.9 81.31 290.6 106.6L255.1 141.3z"},null,-1)])])}const it=v(st,[["render",at]]),ct={},lt={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"};function ut(n,e){return p(),g("svg",lt,[...e[0]||(e[0]=[l("path",{fill:"currentColor",d:"M256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C172.2 512 97.87 471.8 51.19 409.6C45.88 402.5 47.31 392.5 54.37 387.2C61.44 381.9 71.47 383.3 76.78 390.4C117.7 444.8 182.7 480 256 480C379.7 480 480 379.7 480 256C480 132.3 379.7 32 256 32C166.7 32 89.51 84.3 53.55 160H144C152.8 160 160 167.2 160 176C160 184.8 152.8 192 144 192H16C7.164 192 0 184.8 0 176V48C0 39.16 7.164 32 16 32C24.84 32 32 39.16 32 48V131.1C75.66 53.29 159.6 0 256 0zM256 128C264.8 128 272 135.2 272 144V249.4L347.3 324.7C353.6 330.9 353.6 341.1 347.3 347.3C341.1 353.6 330.9 353.6 324.7 347.3L244.7 267.3C241.7 264.3 239.1 260.2 239.1 256V144C239.1 135.2 247.2 128 255.1 128H256z"},null,-1)])])}const dt=v(ct,[["render",ut]]),mt={},pt={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"};function Ct(n,e){return p(),g("svg",pt,[...e[0]||(e[0]=[l("path",{fill:"currentColor",d:"M224 256c70.7 0 128-57.31 128-128s-57.3-128-128-128C153.3 0 96 57.31 96 128S153.3 256 224 256zM224 32c52.94 0 96 43.06 96 96c0 52.93-43.06 96-96 96S128 180.9 128 128C128 75.06 171.1 32 224 32zM274.7 304H173.3C77.61 304 0 381.6 0 477.3c0 19.14 15.52 34.67 34.66 34.67h378.7C432.5 512 448 496.5 448 477.3C448 381.6 370.4 304 274.7 304zM413.3 480H34.66C33.2 480 32 478.8 32 477.3C32 399.4 95.4 336 173.3 336h101.3C352.6 336 416 399.4 416 477.3C416 478.8 414.8 480 413.3 480z"},null,-1)])])}const ft=v(mt,[["render",Ct]]);b.register("analytic:guild",ot);b.register("analytic:heart",it);b.register("analytic:history",dt);b.register("analytic:user",ft);const gt=n=>{n.plugin(G),n.slot({type:"home",component:Z,order:0})};export{gt as default};
