import{Universal as y,withProxy as P,useConfig as Z,store as u,router as D,capitalize as A,message as U,icons as I,Schema as B}from"@koishijs/client";import{createElementBlock as l,openBlock as s,defineComponent as S,resolveComponent as N,createElementVNode as c,normalizeStyle as z,unref as i,createVNode as v,withCtx as C,normalizeClass as E,createTextVNode as w,toDisplayString as d,computed as b,createBlock as k,createCommentVNode as O,Fragment as m,renderList as x,inject as F}from"vue";function R(e){switch(e){case y.Status.OFFLINE:return"offline";case y.Status.ONLINE:return"online";case y.Status.CONNECT:return"connect";case y.Status.DISCONNECT:return"disconnect";case y.Status.RECONNECT:return"reconnect"}}const f=(e,t)=>{const r=e.__vccOpts||e;for(const[a,o]of t)r[a]=o;return r},Q={},q={class:"status-light"};function K(e,t){return s(),l("span",q)}const j=f(Q,[["render",K],["__scopeId","data-v-5269806f"]]),G={class:"bot-view"},J={class:"info"},W=["title"],X=["title"],Y={class:"truncate cur-frequency"},tt={style:{"margin-right":"8px"}},et=S({__name:"preview",props:{data:{}},setup(e){const t={[y.Status.ONLINE]:"运行中",[y.Status.OFFLINE]:"离线",[y.Status.CONNECT]:"正在连接",[y.Status.RECONNECT]:"正在重连",[y.Status.DISCONNECT]:"正在断开"};return(r,a)=>{const o=N("el-tooltip"),n=N("k-icon");return s(),l("section",G,[c("div",{class:"avatar",style:z({backgroundImage:`url(${i(P)(e.data.user.avatar)})`}),onClick:a[0]||(a[0]=_=>r.$emit("avatar-click"))},[v(o,{content:t[e.data.status],placement:"right"},{default:C(()=>[v(j,{class:E(i(R)(e.data.status))},null,8,["class"])]),_:1},8,["content"])],4),c("div",J,[c("div",{class:"truncate",title:e.data.user.name},[v(n,{name:"robot"}),w(d(e.data.user.name),1)],8,W),c("div",{class:"truncate",title:e.data.platform},[v(n,{name:"platform"}),w(d(e.data.platform),1)],8,X),c("div",Y,[c("span",tt,[v(n,{name:"arrow-up"}),c("span",null,d(e.data.messageSent)+"/min",1)]),c("span",null,[v(n,{name:"arrow-down"}),c("span",null,d(e.data.messageReceived)+"/min",1)])])])])}}}),M=f(et,[["__scopeId","data-v-af9427ba"]]),nt={key:0,class:"el-popper__empty"},st={class:"count"},ot=S({__name:"index",setup(e){const t=Z(),r=b(()=>{const n={};for(const _ of Object.values(u.status.bots)){const p=R(_.status);n[p]=(n[p]||0)+1}return Object.fromEntries(Object.entries(n).sort((_,p)=>_[0].localeCompare(p[0])))}),a=b(()=>Object.values(u.status.bots).reduce((n,_)=>n+_.messageSent,0)),o=b(()=>Object.values(u.status.bots).reduce((n,_)=>n+_.messageReceived,0));return(n,_)=>{const p=N("k-icon"),$=N("k-status");return i(u).status?(s(),k($,{key:0},{tooltip:C(()=>[Object.values(i(u).status.bots).length?O("v-if",true):(s(),l("span",nt)),(s(true),l(m,null,x(i(u).status.bots,(g,h)=>{var L;return s(),k(M,{key:h,data:g,class:E({"has-link":(L=g.paths)==null?void 0:L.length}),onClick:V=>i(D).push("/plugins/"+g.paths[0].replace(/\./,"/"))},null,8,["data","class","onClick"])}),128))]),default:C(()=>[(s(true),l(m,null,x(r.value,(g,h)=>(s(),l(m,{key:h},[g>(i(t).mergeThreshold??10)?(s(),l(m,{key:0},[v(j,{class:E(h)},null,8,["class"]),c("span",st,"×"+d(g),1)],64)):(s(true),l(m,{key:1},x(Array(g),(L,V)=>(s(),k(j,{key:V,class:E(h)},null,8,["class"]))),128))],64))),128)),v(p,{name:"arrow-up"}),c("span",null,d(a.value)+"/min",1),v(p,{name:"arrow-down"}),c("span",null,d(o.value)+"/min",1)]),_:1})):O("v-if",true)}}}),at=f(ot,[["__scopeId","data-v-a3e59fe7"]]),ct=e=>{e.slot({type:"status-right",component:at})},rt={class:"load-bar"},lt={class:"title"},it={class:"body"},ut=S({__name:"load-bar",props:{rate:{},title:{}},setup(e){const t=e;function r(p,$=1){return+(p*100).toFixed($)+"%"}const a=["used","app","free"],o=b(()=>[t.rate[1]-t.rate[0],t.rate[0],1-t.rate[1]]),n=b(()=>o.value.findIndex(p=>p>=.5)),_=b(()=>`${r(t.rate[0],1)} / ${r(t.rate[1],1)}`);return(p,$)=>(s(),l("div",rt,[c("span",lt,d(e.title),1),c("span",it,[(s(),l(m,null,x(a,(g,h)=>c("span",{key:g,class:E([g,"bar"]),style:z({width:r(o.value[h])})},[h===n.value?(s(),l(m,{key:0},[w(d(_.value),1)],64)):n.value===-1&&o.value[h]>=.2?(s(),l(m,{key:1},[w(d(r(o.value[h])),1)],64)):O("v-if",true)],6)),64))])]))}}),H=f(ut,[["__scopeId","data-v-74e007b8"]]);function T(e,t=3){return(e*100).toFixed(t)+"%"}const dt={class:"load"},_t=S({__name:"index",setup(e){return(t,r)=>{const a=N("k-status");return i(u).status?(s(),k(a,{key:0},{tooltip:C(()=>[c("div",dt,[v(H,{title:"CPU",rate:i(u).status.cpu},null,8,["rate"]),v(H,{title:"内存",rate:i(u).status.memory},null,8,["rate"])])]),default:C(()=>[w(" CPU: "+d(i(T)(i(u).status.cpu[1],0))+" 内存: "+d(i(T)(i(u).status.memory[1],0)),1)]),_:1})):O("v-if",true)}}}),pt=f(_t,[["__scopeId","data-v-1f71e878"]]),mt=e=>{e.slot({type:"status-right",component:pt})},ft=S({__name:"analytics",setup(e){const t=F("component:analytic-number"),r=b(()=>Object.values(u.status.bots).reduce((o,n)=>o+n.messageReceived,0)/60),a=b(()=>Object.values(u.analytics.messageByDate).slice(-7).reduce((o,n)=>o+n.receive,0)/7/24/60/60);return(o,n)=>(s(),k(i(t),{icon:"analytic:pulse",title:"当前 QPS"},{default:C(()=>[w(d(+r.value.toFixed(2)),1)]),"footer-left":C(()=>[...n[0]||(n[0]=[w("近期 QPS",-1)])]),"footer-right":C(()=>[w(d(+a.value.toFixed(2)),1)]),_:1}))}}),vt={class:"bots-container flex flex-wrap gap-4"},gt=S({__name:"config",setup(e){const t=F("manager.settings.current"),r=b(()=>{var a;return Object.values(((a=u.status)==null?void 0:a.bots)||{}).filter(o=>{var n;return(n=o.paths)==null?void 0:n.includes(t.value.path)})});return(a,o)=>{var n;return(n=r.value)!=null&&n.length?(s(),l(m,{key:0},[o[0]||(o[0]=c("h2",{class:"k-schema-header"}," 机器人 ",-1)),c("div",vt,[(s(true),l(m,null,x(r.value,(_,p)=>(s(),k(M,{key:p,data:_},null,8,["data"]))),128))])],64)):O("v-if",true)}}}),ht=f(gt,[["__scopeId","data-v-6634ad0b"]]);async function yt(e){try{return navigator.clipboard.writeText(e)}catch{const t=document.createElement("textarea"),r=document.activeElement;t.value=e,t.setAttribute("readonly",""),t.style.contain="strict",t.style.position="absolute",t.style.left="-9999px",t.style.fontSize="12pt";const a=document.getSelection(),o=a?a.rangeCount>0&&a.getRangeAt(0):null;document.body.appendChild(t),t.select(),t.selectionStart=0,t.selectionEnd=e.length,document.execCommand("copy"),document.body.removeChild(t),o&&(a.removeAllRanges(),a.addRange(o)),r&&r.focus()}}const Ct={class:"section"},wt={class:"title"},bt=S({__name:"envinfo",setup(e){async function t(){const r=Object.entries(u.envinfo).map(([a,o])=>`${A(a)}:
`+Object.entries(o).map(([n,_])=>`    ${n}: ${_}`).join(`
`)).join(`

`);await yt(r),U.success("已复制环境信息！")}return(r,a)=>{const o=N("k-status");return i(u).envinfo?(s(),k(o,{key:0,class:"version",onClick:t},{tooltip:C(()=>[(s(true),l(m,null,x(i(u).envinfo,(n,_)=>(s(),l("div",Ct,[c("p",wt,d(i(A)(_))+":",1),(s(true),l(m,null,x(n,(p,$)=>(s(),l("p",{class:"info",key:$},d($)+": "+d(p),1))),128))]))),256))]),default:C(()=>[w(" Koishi v"+d(i(u).envinfo.koishi.Core)+" ",1)]),_:1})):O("v-if",true)}}}),$t=f(bt,[["__scopeId","data-v-66363001"]]),kt={},xt={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512"};function St(e,t){return s(),l("svg",xt,[...t[0]||(t[0]=[c("path",{fill:"currentColor",d:"M6.625 215.5l168-176C179.2 34.7 185.4 32.02 192 32.02s12.84 2.688 17.38 7.438l168 176c9.125 9.594 8.781 24.78-.8125 33.94c-9.5 9.156-24.75 8.812-33.94-.8125L216 115.9V456c0 13.25-10.75 23.1-23.1 23.1S168 469.3 168 456V115.9l-126.6 132.7C32.22 258.2 16.97 258.5 7.438 249.4C-2.156 240.2-2.5 225 6.625 215.5z"},null,-1)])])}const Nt=f(kt,[["render",St]]),Ot={},Et={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512"};function It(e,t){return s(),l("svg",Et,[...t[0]||(t[0]=[c("path",{fill:"currentColor",d:"M377.4 296.6l-168 176C204.8 477.3 198.6 480 192 480s-12.84-2.688-17.38-7.438l-168-176C-2.5 286.1-2.156 271.8 7.438 262.6c9.5-9.156 24.75-8.812 33.94 .8125L168 396.1V56.02c0-13.25 10.75-24.01 23.1-24.01S216 42.77 216 56.02v340.1l126.6-132.7c9.156-9.625 24.41-9.969 33.94-.8125C386.2 271.8 386.5 286.1 377.4 296.6z"},null,-1)])])}const Lt=f(Ot,[["render",It]]),jt={},Vt={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"};function At(e,t){return s(),l("svg",Vt,[...t[0]||(t[0]=[c("path",{fill:"currentColor",d:"M12.41 148.02l232.94 105.67c6.8 3.09 14.49 3.09 21.29 0l232.94-105.67c16.55-7.51 16.55-32.52 0-40.03L266.65 2.31a25.607 25.607 0 0 0-21.29 0L12.41 107.98c-16.55 7.51-16.55 32.53 0 40.04zm487.18 88.28l-58.09-26.33-161.64 73.27c-7.56 3.43-15.59 5.17-23.86 5.17s-16.29-1.74-23.86-5.17L70.51 209.97l-58.1 26.33c-16.55 7.5-16.55 32.5 0 40l232.94 105.59c6.8 3.08 14.49 3.08 21.29 0L499.59 276.3c16.55-7.5 16.55-32.5 0-40zm0 127.8l-57.87-26.23-161.86 73.37c-7.56 3.43-15.59 5.17-23.86 5.17s-16.29-1.74-23.86-5.17L70.29 337.87 12.41 364.1c-16.55 7.5-16.55 32.5 0 40l232.94 105.59c6.8 3.08 14.49 3.08 21.29 0L499.59 404.1c16.55-7.5 16.55-32.5 0-40z"},null,-1)])])}const Bt=f(jt,[["render",At]]),Ht={},Tt={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 512"};function zt(e,t){return s(),l("svg",Tt,[...t[0]||(t[0]=[c("path",{fill:"currentColor",d:"M640 240C640 248.8 632.8 256 624 256h-133.1l-60 150c-2.625 6.375-8.375 10.25-16 9.1C408 415.5 402.1 410.6 400.5 403.9l-78.75-315l-82 410.3C238.3 506.5 231.9 511.8 224.4 512H224c-7.25 0-13.75-5-15.5-12.12L147.5 256H16C7.201 256 0 248.8 0 240s7.201-15.1 16-15.1H160c7.375 0 13.75 4.993 15.5 12.12l46.75 187l82-410.3C305.8 5.5 312 .25 319.5 0c8.125 .125 14.25 4.875 16 12.12l84 336l45.63-114.1C467.5 228 473.5 224 480 224h144C632.8 224 640 231.2 640 240z"},null,-1)])])}const Ft=f(Ht,[["render",zt]]),Rt={},Mt={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 512"};function Pt(e,t){return s(),l("svg",Mt,[...t[0]||(t[0]=[c("path",{fill:"currentColor",d:"M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"},null,-1)])])}const Zt=f(Rt,[["render",Pt]]);I.register("arrow-up",Nt);I.register("arrow-down",Lt);I.register("platform",Bt);I.register("analytic:pulse",Ft);I.register("robot",Zt);const Qt=e=>{e.plugin(ct),e.plugin(mt),e.slot({type:"status-left",component:$t}),e.slot({type:"analytic-number",component:ft}),e.slot({type:"plugin-details",component:ht,order:-500}),e.settings({id:"status",schema:B.object({mergeThreshold:B.number().default(10).description("当机器人的数量超过这个值时将合并显示状态指示灯。")}).description("机器人设置")})};export{Qt as default};
