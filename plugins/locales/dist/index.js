import{store as _,send as Q,icons as S}from"@koishijs/client";import{defineComponent as X,ref as N,watch as Y,computed as U,provide as Z,resolveComponent as u,createBlock as L,openBlock as a,withCtx as s,createVNode as C,createElementBlock as k,Fragment as g,renderList as B,createElementVNode as m,toDisplayString as z,unref as H,createCommentVNode as ee,createTextVNode as R}from"vue";import{useRoute as te,useRouter as oe}from"vue-router";import{useDebounceFn as le}from"@vueuse/core";const ne={class:"menu-item"},se={class:"search"},ae={class:"grid my-4 translation gap-y-2"},ce={class:"lh-8 px-4"},re=X({__name:"locales",setup(h){const p=te(),V=oe(),y=N(["zh-CN","en-US"]),$=N(null),b=N("");Y(b,t=>{$.value.filter(t)});const o=U({get(){const t=p.path.slice(9).replace(/\//g,".");return t in w.value.map?t:""},set(t){t in w.value.map||(t=""),V.replace("/locales/"+t.replace(/\./g,"/"))}});Z("locale:prefix",o);function W(t,e){return e.label.toLowerCase().includes(b.value.toLowerCase())}function A(t){const e=[];return t.id===o.value&&e.push("is-active"),e.join(" ")}function G(t){o.value=t.id}const O=U(()=>{const t={};for(const e in _.locales)Object.assign(t,_.locales[e]);return Object.keys(t).filter(e=>!e.includes("._")&&!e.includes("@"))});function D(t){t.sort((e,i)=>e.label.localeCompare(i.label));for(const e of t)e.children&&D(e.children)}const w=U(()=>{const t=[],e={};for(const i of O.value){const l=i.split(".");if(l.length<2||i.includes("$"))continue;let f=t,d=Math.min(l.length-1,2);for(let n=l.length-1;n>=d;n--)if(O.value.includes(l.slice(0,n).join(".")+".$")){d=n;break}for(let n=0;n<d;n++){const M=l[n],x=l.slice(0,n+1).join(".");let v=f.find(j=>j.id===x);v||(v={id:x,label:M},f.push(v),e[x]=[]),f=v.children??(v.children=[])}e[l.slice(0,d).join(".")].push(l.slice(d).join("."))}return D(t),{data:t,map:e}}),q=le(()=>{const t={};for(const e in _.locales)e.startsWith("$")&&(t[e.slice(1)]=_.locales[e]);Q("l10n",t)},1e3);function I(t,e,i){var f,d;const l=(f=_.locales)[d="$"+t]??(f[d]={});i?l[`${o.value}.${e}`]=i:l[`${o.value}.${e}`]=null,q()}return(t,e)=>{const i=u("k-icon"),l=u("el-checkbox"),f=u("el-checkbox-group"),d=u("el-dropdown"),n=u("el-input"),M=u("el-tree"),x=u("el-scrollbar"),v=u("k-slot"),j=u("k-content"),J=u("k-empty"),K=u("k-layout");return a(),L(K,{class:"page-locales"},{header:s(()=>[R(" 本地化"+z(o.value?" - "+o.value:""),1)]),menu:s(()=>[C(d,{placement:"bottom","popper-class":"k-dropdown"},{dropdown:s(()=>[C(f,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=c=>y.value=c)},{default:s(()=>[(a(true),k(g,null,B(H(_).locales,(c,r)=>(a(),k(g,{key:r},[r&&!r.startsWith("$")?(a(),L(l,{key:0,label:r},{default:s(()=>[R(z(r),1)]),_:2},1032,["label"])):ee("v-if",true)],64))),128))]),_:1},8,["modelValue"])]),default:s(()=>[m("span",ne,[C(i,{class:"menu-icon",name:"globe"})])]),_:1})]),left:s(()=>[C(x,null,{default:s(()=>[m("div",se,[C(n,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=c=>b.value=c)},{suffix:s(()=>[C(i,{name:"search"})]),_:1},8,["modelValue"])]),C(M,{ref_key:"tree",ref:$,data:w.value.data,props:{class:A},"filter-node-method":W,"default-expand-all":true,"expand-on-click-node":false,onNodeClick:G},null,8,["data","props"])]),_:1})]),default:s(()=>[o.value?(a(),L(j,{key:0},{default:s(()=>[C(v,{name:"locale-main",data:{active:o.value}},null,8,["data"]),(a(true),k(g,null,B(w.value.map[o.value],c=>(a(),k(g,{key:c},[m("h3",null,z(c),1),m("div",ae,[(a(true),k(g,null,B(y.value,r=>{var E,F;return a(),k(g,{key:r},[m("div",ce,z(r),1),m("div",null,[C(n,{autosize:"",type:"textarea",modelValue:(E=H(_).locales["$"+r])==null?void 0:E[`${o.value}.${c}`],placeholder:((F=H(_).locales[r])==null?void 0:F[`${o.value}.${c}`])||H(_).locales[""][`${o.value}.${c}`],"onUpdate:modelValue":P=>I(r,c,P)},null,8,["modelValue","placeholder","onUpdate:modelValue"])])],64)}),128))])],64))),128))]),_:1})):(a(),L(J,{key:1},{default:s(()=>[...e[2]||(e[2]=[m("div",null,"请在左侧选择类别",-1)])]),_:1}))]),_:1})}}}),T=(h,p)=>{const V=h.__vccOpts||h;for(const[y,$]of p)V[y]=$;return V},ue={},ie={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"};function de(h,p){return a(),k("svg",ie,[...p[0]||(p[0]=[m("path",{fill:"currentColor",d:"M386.7 22.63C411.7-2.365 452.3-2.365 477.3 22.63L489.4 34.74C514.4 59.74 514.4 100.3 489.4 125.3L269 345.6C260.6 354.1 249.9 359.1 238.2 362.7L147.6 383.6C142.2 384.8 136.6 383.2 132.7 379.3C128.8 375.4 127.2 369.8 128.4 364.4L149.3 273.8C152 262.1 157.9 251.4 166.4 242.1L386.7 22.63zM454.6 45.26C442.1 32.76 421.9 32.76 409.4 45.26L382.6 72L440 129.4L466.7 102.6C479.2 90.13 479.2 69.87 466.7 57.37L454.6 45.26zM180.5 281L165.3 346.7L230.1 331.5C236.8 330.2 242.2 327.2 246.4 322.1L417.4 152L360 94.63L189 265.6C184.8 269.8 181.8 275.2 180.5 281V281zM208 64C216.8 64 224 71.16 224 80C224 88.84 216.8 96 208 96H80C53.49 96 32 117.5 32 144V432C32 458.5 53.49 480 80 480H368C394.5 480 416 458.5 416 432V304C416 295.2 423.2 288 432 288C440.8 288 448 295.2 448 304V432C448 476.2 412.2 512 368 512H80C35.82 512 0 476.2 0 432V144C0 99.82 35.82 64 80 64H208z"},null,-1)])])}const pe=T(ue,[["render",de]]),_e={},Ce={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"};function me(h,p){return a(),k("svg",Ce,[...p[0]||(p[0]=[m("path",{fill:"currentColor",d:"M256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256C0 114.6 114.6 0 256 0zM256 464C263.4 464 282.1 456.8 303.6 415.6C312.4 397.9 319.1 376.4 325.6 352H186.4C192 376.4 199.6 397.9 208.4 415.6C229 456.8 248.6 464 256 464zM178.5 304H333.5C335.1 288.7 336 272.6 336 256C336 239.4 335.1 223.3 333.5 208H178.5C176.9 223.3 176 239.4 176 256C176 272.6 176.9 288.7 178.5 304V304zM325.6 160C319.1 135.6 312.4 114.1 303.6 96.45C282.1 55.22 263.4 48 256 48C248.6 48 229 55.22 208.4 96.45C199.6 114.1 192 135.6 186.4 160H325.6zM381.8 208C383.2 223.5 384 239.6 384 256C384 272.4 383.2 288.5 381.8 304H458.4C462.1 288.6 464 272.5 464 256C464 239.5 462.1 223.4 458.4 208H381.8zM342.1 66.61C356.2 92.26 367.4 124.1 374.7 160H440.6C419.2 118.9 384.4 85.88 342.1 66.61zM169.9 66.61C127.6 85.88 92.84 118.9 71.43 160H137.3C144.6 124.1 155.8 92.26 169.9 66.61V66.61zM48 256C48 272.5 49.93 288.6 53.57 304H130.2C128.8 288.5 128 272.4 128 256C128 239.6 128.8 223.5 130.2 208H53.57C49.93 223.4 48 239.5 48 256zM440.6 352H374.7C367.4 387.9 356.2 419.7 342.1 445.4C384.4 426.1 419.2 393.1 440.6 352zM137.3 352H71.43C92.84 393.1 127.6 426.1 169.9 445.4C155.8 419.7 144.6 387.9 137.3 352V352z"},null,-1)])])}const fe=T(_e,[["render",me]]);S.register("activity:locales",pe);S.register("globe",fe);const ye=h=>{h.page({path:"/locales/:path*",name:"本地化",icon:"activity:locales",order:450,authority:4,fields:["locales"],component:re})};export{ye as default};
